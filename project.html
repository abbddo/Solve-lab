<!DOCTYPE html>
<html>
<head>
    <title>Slider Crank</title>
</head>

<style type="text/css">
	html, body{
		background: black;
		margin: 0px;
		padding: 0px;
	}
	canvas {
		background: white;
	}
  #crankSliderId{
    left: 80px;
  }
  #connectingRodSliderId{
    left: 80px;
  }
  #omega2SliderId{
      left: 80px;
  }
  .variableSlider{
    position: absolute;
  }

</style>


<body>

  <select id="data1" class="variableSlider">
    <option value="1">Slider</option>
    <option value="2">Phi</option>
    <option value="3">Data</option>
  </select>

  <select id="data2" class="variableSlider">
    <option value="2">Phi</option>
    <option value="1">Slider</option>
    <option value="3">Data</option>
  </select>

  <canvas width = "1280" height="606" id = "myCanvas">
 Update browser
</canvas>


<input type="range" min="50" max="100" step="1" id="crankSliderId" class="variableSlider"   onmousedown="f1()" onmouseleave="f2()">
<input type="range" min="201" max="700" step="1" id="connectingRodSliderId" class="variableSlider" onmousedown="f1()" onmouseleave="f2()">
<input type="range" min="0" max="5" value="2" step="0.01" id="omega2SliderId" class="variableSlider" onmousedown="f1()" onmouseleave="f2()">

<input type="text" id="crankLengthTextId" placeholder="100" class="variableSlider" onfocus="f2()" onchange="set1()">
<input type="text" id="connectingRodTextId" placeholder="300" class="variableSlider" onfocus="f2()" onchange="set1()">
<input type="text" id="omega2TextId" placeholder="3" class="variableSlider" onfocus='f2()' onchange='set1()'>
<input type="text" id="setAngleId" placeholder="angle" class="variableSlider" onblur="stop()">

<input type="checkbox" id="dirReverse" class="variableSlider">

<script src="object.js"></script>

<script type="text/javascript">

    var canvas = document.getElementById('myCanvas');
    var ctx = canvas.getContext('2d');
    var crankSlider=document.getElementById("crankSliderId");
    var connectingRodSlider=document.getElementById("connectingRodSliderId");
    var omega2Slider=document.getElementById("omega2SliderId");

    var crankLengthText=document.getElementById("crankLengthTextId");
    var connectingRodText=document.getElementById("connectingRodTextId");
    var omega2Text=document.getElementById("omega2TextId");

    var dirRev=document.getElementById("dirReverse");
    var data1=document.getElementById("data1");
    var data2=document.getElementById("data2");
    var setAngle=document.getElementById("setAngleId");
    var submit=document.getElementById("button");

    var ratio=canvas.width/1280;

    var antiClock=document.getElementById("antiClockId");


    crank = new Rod(200*ratio,10*ratio, canvas);
    connectingRod = new Rod(300*ratio,10*ratio, canvas);
    slider = new Slider(200*ratio,50*ratio, canvas, origin = [0,0]);


    function inputResize(tem,l,h) {

      if(l<3){
        //for slider and text box
        tem.style.width=(canvas.width/6/h).toString()+'px';
        tem.style.left=(l*20+l*canvas.width/6 +canvas.width/30+parseInt(canvas.style.marginLeft)).toString()+'px';
        tem.style.top=((h+1)*canvas.height/20 + parseInt(canvas.style.marginTop)).toString()+'px';
        }

      else {
        //for the dropdown and angle
        tem.style.width=(canvas.width/10).toString()+'px';
        tem.style.left=(parseFloat(canvas.style.marginLeft)+ canvas.width*8/10).toString()+'px'
        tem.style.top=(canvas.height*(h-0.5)/10 +parseFloat(canvas.style.marginTop)).toString()+'px';
        }

      }

      function displayText(ctx,text,ri,rj){
        ctx.font='16px sans serif';
        var max=canvas.width/10;
        var i=canvas.width*ri;
        var j=canvas.height*rj;
        ctx.fillText(text,i,j,max);
      }

    function resize(){
    	if(window.innerHeight > window.innerWidth/aspectRatio){
    		canvas.width  = window.innerWidth;
	      canvas.height = window.innerWidth/aspectRatio;
	      canvas.style.marginTop = ((window.innerHeight - canvas.height)/2).toString() + 'px';
	      canvas.style.marginLeft = ((window.innerWidth - canvas.width)/2).toString() + 'px';
    	}
    	else{
      	canvas.height = window.innerHeight;
    		canvas.width = window.innerHeight*aspectRatio;
    		canvas.style.marginLeft = ((window.innerWidth - canvas.width)/2).toString() + 'px';
    		canvas.style.marginTop = ((window.innerHeight - canvas.height)/2).toString() + 'px';
    	}
   //for the input sliders
    inputResize(crankSlider,0,1);
    inputResize(connectingRodSlider,1,1);
    inputResize(omega2Slider,2,1);

    //for the input text boxes
    inputResize(crankLengthText,0,2);
    inputResize(connectingRodText,1,2);
    inputResize(omega2Text,2,2);

    //for the angle and dropdown menu
    inputResize(setAngle,3,1);
    inputResize(data1,3,2);
    inputResize(data2,3,3);

    ctx.font='16px sans serif';
    //for the dropdown menu text
    displayText(ctx,'Set Angle',7/10,(1-0.25)/10);
    displayText(ctx,'Display 1',7/10,(2-0.25)/10);
    displayText(ctx,'Display 2',7/10,(3-0.25)/10);

    //text near the sliders
    displayText(ctx,'Crank Length',1/20,1/20);
    displayText(ctx,'Connecting Rod',4.5/20,1/20);
    displayText(ctx,'Angular Speed',8/20,1/20)

    setAngle.style.width=(50*ratio).toString()+'px';

    dirRev.style.left=(parseFloat(canvas.style.marginLeft)+canvas.width*5/10).toString()+'px';
    dirRev.style.top=(parseFloat(canvas.style.marginTop)+canvas.height*2/10).toString()+'px';
    ctx.fillText('Counter Clockwise',canvas.width*5.5/10,canvas.height*2.25/10,canvas.width/10);
    }

    function drawAxis(ctx,startX,startY,endX,endY){
      //y axis
      ctx.beginPath();
      ctx.moveTo(startX[0],startX[1]);
      ctx.lineTo(endX[0],endX[1]);
      ctx.stroke();
      ctx.closePath();
      //x axis
      ctx.beginPath();
      ctx.moveTo(startY[0],startY[1]);
      ctx.lineTo(endY[0],endY[1]);
      ctx.stroke();
      ctx.closePath();
    }

    function drawDynamicGraph(ctx,i,j,fn,adjust,scaling){
        var k;
        for(k=-360;k<=0;k++){
          ctx.beginPath();
          ctx.moveTo(i+k*ratio,j- adjust -(fn(k +angle))*ratio*scaling);
          ctx.lineTo(i+(k+1)*ratio,j- adjust -(fn(k+1 +angle))*ratio*scaling)
          ctx.stroke();
          ctx.closePath();
        }
    }


    function table(ctx,i,j,text,offset,value){
      ctx.fillText(text,i,j,canvas.width/5);
      ctx.fillText(value,i+offset,j,canvas.width/8);
    }

    function simpleTable(ctx,len){
      var value=Math.round(calculatePhi(angle)*100)/100;
      table(ctx,len*ratio,400*ratio,'Phi :',300*ratio,value);

      value=Math.round(sliderPositionFromCrank(angle)*100)/100;
      table(ctx,len*ratio,450*ratio,'Slider Position from Crank :',300*ratio,value);

      table(ctx,len*ratio,500*ratio,'Slider Min :',300*ratio,sliderPositionFromCrank(180));

      table(ctx,len*ratio,550*ratio,'Slider Max :',300*ratio,sliderPositionFromCrank(0));

      value=Math.round(crank.length/connectingRod.length*100)/100;
      table(ctx,len*ratio,600*ratio,'Crank Connecting Rod Ratio :',300*ratio,value);

      table(ctx,len*ratio,650*ratio,'Crank Angle',300*ratio,360-Math.round(angle));
    }

    function drawGraph(){

      ctx.lineWidth=2;
      //axis for slider graph
      if(data1.value==1){
        drawAxis(ctx,[canvas.width/5,canvas.height*9/10],
        [canvas.width/5,canvas.height*9/10],[canvas.width/2,canvas.height*9/10],[canvas.width/5,(canvas.height*9/10-(sliderPositionFromCrank(0)/3.5)*ratio)]);

      //slider vs time graph
        drawDynamicGraph(ctx,615*ratio,980*ratio,sliderPositionFromCrank,(300+crank.length/10)*ratio,1/3);
      }
    else if (data1.value==2) {
        //axis for phi graph
      drawAxis(ctx,[250*ratio,570*ratio],[250*ratio,570*ratio-200*calculatePhi(90)*ratio],[610*ratio,570*ratio],
      [250*ratio,570*ratio-200*calculatePhi(270)*ratio]);

      //phi vs time graph
      drawDynamicGraph(ctx,610*ratio,720*ratio,calculatePhi,150*ratio,200);
      }

      else {
        simpleTable(ctx,150);
      }

    if(data2.value==1){
        //axis for slider graph
      drawAxis(ctx,[820*ratio,canvas.height*9/10],
      [820*ratio,canvas.height*9/10],[1200*ratio,canvas.height*9/10],[820*ratio,(canvas.height*9/10-(sliderPositionFromCrank(0)/3.5)*ratio)]);
      //slider vs time graph
      drawDynamicGraph(ctx,1180*ratio,980*ratio,sliderPositionFromCrank,(300+crank.length/10)*ratio,1/3);
    }

      else if(data2.value==2){
          //axis for phi graph
        drawAxis(ctx,[820*ratio,570*ratio],[820*ratio,571*ratio-200*calculatePhi(90)*ratio],[1200*ratio,570*ratio],
        [820*ratio,570*ratio-200*calculatePhi(270)*ratio])
        //phi vs time graph
        drawDynamicGraph(ctx,1180*ratio,720*ratio,calculatePhi,150*ratio,200);
      }

      else {
        simpleTable(ctx,820);
      }
    }

    function drawTarget(){
        ctx.clearRect(0, 0, canvas.width , canvas.height);

        ratio=canvas.width/1280;

        crank.length=parseFloat(crankSlider.value);
        connectingRod.length=parseFloat(connectingRodSlider.value);

        if(f==1){
        crankLengthText.value=crankSlider.value;
        connectingRodText.value=connectingRodSlider.value;
        omega2Text.value=omega2Slider.value;
        }
        if((parseFloat(omega2Slider.value)!=0)&&(flag==0)){
          flag=1;
         setAngle.value="";
        }
        if(flag==1){
            incrementAngle();
        }

        resize();

      	crank.attach([canvas.width/5,canvas.height/2.75]);
      	crank.rotate(angle,[0,0]);

        connectingRod.attach(crank.right);
        connectingRod.rotate(convertToDegree(calculatePhi(angle)),[0,0],drawCircumference = false);

        slider.addi([slider.length/2,0]);
        slider.attach(connectingRod.right,slider.imagePoint[0]);
        slider.rotate(0);

        slider.imagePoint=[];//empties the arrray
      	drawGraph();
    }

    setInterval(drawTarget, 1000/fps);
</script>
</body>
</html>
