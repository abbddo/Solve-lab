<!DOCTYPE html>
<html>
<head>
    <title>Slider Crank</title>
</head>

<style type="text/css">

	html, body{
		background: black;
		margin: 0px;
		padding: 0px;
	}

	canvas {
		background: white;
	}

  #crankSliderId{
    left: 80px;
  }

  #connectingRodSliderId{
    left: 80px;
  }

  #omega2SliderId{
      left: 80px;
  }
  .variableSlider{
    position: absolute;
    width: 1000px;
    top:20px;
  }
</style>


<body>

  <canvas  width = "1280" height="606" id = "myCanvas">
 Update browser
</canvas>

<input type="range" min="50" max="100" step="1" id="crankSliderId" class="variableSlider">
<input type="range" min="201" max="700" step="1" id="connectingRodSliderId" class="variableSlider">
<input type="range" min="0" max="5" value="1" step="0.01" id="omega2SliderId" class="variableSlider">

<script type="text/javascript">

    var Rod = function(length,thickness){
      this.length=length;
      this.thickness=thickness;
    };

    var Slider = function(length,breadth){
      this.length=length;
      this.breadth=breadth;
    };

    var canvas = document.getElementById('myCanvas');
    var ctx = document.getElementById('myCanvas').getContext('2d');
    var crankSlider=document.getElementById("crankSliderId");
    var connectingRodSlider=document.getElementById("connectingRodSliderId");
    var omega2Slider=document.getElementById("omega2SliderId");

    var angle = 0;
    var fps=60;
    var ratio=canvas.width/1280;
    var aspectRatio=16/9;

    slider = new Slider(200*ratio,50*ratio);
    crank = new Rod(200*ratio,10*ratio);
    connectingRod = new Rod(300*ratio,10*ratio);

    function convertToRadian(degree){
        return degree*(Math.PI/180);
    }

    function incrementAngle(){
        angle = angle + omega2Slider.value/1;
        if(angle > 360){
            angle = angle - 360;
        }
    }

    function calculatePhi(angle){
        return Math.asin((crank.length * Math.sin(convertToRadian(360 - angle)))/ connectingRod.length)
    }

    function sliderPositionFromCrank(angle){
        return Math.sqrt(Math.pow(connectingRod.length,2) - Math.pow(crank.length*Math.sin(convertToRadian(360 - angle)),2)) + crank.length*Math.cos(convertToRadian(360 - angle))
    }

    function resetOrigin(){
        ctx.setTransform(1, 0, 0, 1, 0, 0);
    }

    function sliderResize(tem,f) {

      tem.style.marginLeft=(canvas.style.marginLeft).toString();
      tem.style.marginTop  =(canvas.style.marginTop).toString();
      tem.style.width=(canvas.width/6).toString()+'px';
      tem.style.left=(f*20+f*canvas.width/6 +canvas.width/30).toString()+'px';
      tem.style.top=(canvas.height/20).toString()+'px';
      }

    function resize(){

    	if(window.innerHeight > window.innerWidth/aspectRatio){
    		canvas.width  = window.innerWidth;
	      canvas.height = window.innerWidth/aspectRatio;
	      canvas.style.marginTop = ((window.innerHeight - canvas.height)/2).toString() + 'px';
	      canvas.style.marginLeft = ((window.innerWidth - canvas.width)/2).toString() + 'px';
    	}

    	else{
      	canvas.height = window.innerHeight;
    		canvas.width = window.innerHeight*aspectRatio;
    		canvas.style.marginLeft = ((window.innerWidth - canvas.width)/2).toString() + 'px';
    		canvas.style.marginTop = ((window.innerHeight - canvas.height)/2).toString() + 'px';
    	}


    sliderResize(crankSlider,0);
    sliderResize(connectingRodSlider,1);
    sliderResize(omega2Slider,2);
    }

    function drawAxis(ctx,startX,startY,endX,endY){
      //y axis
      ctx.beginPath();
      ctx.moveTo(startX[0],startX[1]);
      ctx.lineTo(endX[0],endX[1]);
      ctx.stroke();
      ctx.closePath();

      //x axis
      ctx.beginPath();
      ctx.moveTo(startY[0],startY[1]);
      ctx.lineTo(endY[0],endY[1]);
      ctx.stroke();
      ctx.closePath();
    }
    function drawDynamicGraph(ctx,i,j,fn,adjust,scaling){
        var k;
        for(k=-360;k<=0;k++){
          ctx.beginPath();
          ctx.moveTo(i+k*ratio,j- adjust -(fn(k +angle))*ratio*scaling);
          ctx.lineTo(i+(k+1)*ratio,j- adjust -(fn(k+1 +angle))*ratio*scaling)
          ctx.stroke();
          ctx.closePath();
        }
    }

    function drawGraph(){
      var i = canvas.width - 100*ratio;
      var j = canvas.height;

      ctx.lineWidth=2;
      //axis for slider graph
      drawAxis(ctx,[i-360*ratio,j/2-40*ratio],
      [i-360*ratio,j/2-40*ratio],[i+10*ratio,j/2-40*ratio],[i-360*ratio,(j-(sliderPositionFromCrank(0)+100)*ratio)/2]);

      //axis for phi graph
      drawAxis(ctx,[i-360*ratio,j-150*ratio],[i-360*ratio,j-150*ratio-300*calculatePhi(90)*ratio],[i+10*ratio,j-150*ratio],
      [i-360*ratio,j-150*ratio-300*calculatePhi(270)*ratio])

      //slider vs time graph
      drawDynamicGraph(ctx,i,j,sliderPositionFromCrank,(370+crank.length/10)*ratio,1/3);
      //phi vs time graph
      drawDynamicGraph(ctx,i,j,calculatePhi,150*ratio,300);
    }

    function drawTarget(){

    	resize();
      crank.length=crankSlider.value;
      connectingRod.length=connectingRodSlider.value;

      incrementAngle();
      ctx.clearRect(0, 0, canvas.width , canvas.height);

      ctx.lineWidth = crank.thickness*ratio;
      ctx.translate(canvas.width/5,canvas.height/2.5);
      ctx.rotate(convertToRadian(angle));
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.lineTo(crank.length*ratio,0);
      ctx.stroke()
      ctx.closePath();
      ctx.beginPath();
      ctx.arc(0, 0, crank.length*ratio, 0, 2 * Math.PI, false);
      ctx.lineWidth = crank.thickness/2;
      ctx.stroke();
      ctx.closePath();
      resetOrigin();

      ctx.translate(canvas.width/5 + sliderPositionFromCrank(angle)*ratio, canvas.height/2.5);
      ctx.strokeRect(-slider.length/2*ratio, -slider.breadth/2*ratio, slider.length*ratio, slider.breadth*ratio);
      resetOrigin();

      ctx.translate(canvas.width/5 + crank.length*Math.cos(convertToRadian(angle))*ratio, canvas.height/2.5 + crank.length*Math.sin(convertToRadian(angle))*ratio);
      ctx.rotate(calculatePhi(angle));
      ctx.lineWidth = connectingRod.thickness*ratio;
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.lineTo(connectingRod.length*ratio, 0);
      ctx.stroke();
      ctx.closePath();
      resetOrigin();

      drawGraph();
    }

    setInterval(drawTarget, 1000/fps);

</script>
</body>
</html>
