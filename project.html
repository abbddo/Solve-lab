<!DOCTYPE html>
<html>
<head>
    <title>Slider Crank</title>
</head>

<style type="text/css">

	html, body{
		background: black;
		margin: 0px;
		padding: 0px;
	}

	canvas {
		background: white;
	}

  #crankSliderId{
    left: 80px;
  }

  #connectingRodSliderId{
    left: 80px;
  }

  #omega2SliderId{
      left: 80px;
  }
  .variableSlider{
    position: absolute;
    width: 1000px;
    top:20px;
  }
</style>


<body>

  <canvas  width = "1280" height="606" id = "myCanvas">
 Update browser
</canvas>

<input type="range" min="50" max="100" step="1" id="crankSliderId" class="variableSlider">
<input type="range" min="201" max="700" step="1" id="connectingRodSliderId" class="variableSlider">
<input type="range" min="0" max="5" value="1" step="0.01" id="omega2SliderId" class="variableSlider">

<script type="text/javascript">

    var Rod = function(length,thickness, canvas, origin = [0,0]){
      this.ctx = canvas.getContext('2d');
      this.length=length;
      this.thickness=thickness;
      this.origin = origin;
    };

    Rod.prototype.rotate = function(angle = 0, drawCircumference = true){
    	this.ctx.lineWidth = this.thickness*ratio;
        this.ctx.translate(this.origin[0], this.origin[1]);
        this.ctx.rotate(convertToRadian(angle));
        this.ctx.beginPath();
        this.ctx.moveTo(0,0);
        this.ctx.lineTo(this.length*ratio,0);
        this.ctx.stroke();
        this.ctx.closePath();
        if(drawCircumference == true){
        	this.ctx.beginPath();
        	this.ctx.arc(0,0,this.length*ratio, 0, 2*Math.PI, false);
        	this.ctx.lineWidth = this.thickness/2;
        	this.ctx.stroke();
        	this.ctx.closePath();
        }
      	resetOrigin();
    };

    Rod.prototype.attach = function(point = [0,0]){
    	this.origin = point;
    };

    var Slider = function(length,breadth, canvas, origin = [0,0]){
      this.ctx = canvas.getContext('2d');
      this.length=length;
      this.breadth=breadth;
      this.origin = origin;
    };

    Slider.prototype.attach = function(point = [0,0]){
    	this.origin = point;
    };

    Slider.prototype.rotate = function(angle = 0){
        this.ctx.translate(this.origin[0], this.origin[1]);
        this.ctx.rotate(convertToRadian(angle));
        this.ctx.strokeRect(-this.length/2*ratio, -this.breadth/2*ratio, this.length*ratio, this.breadth*ratio);
        resetOrigin();
    };

    var canvas = document.getElementById('myCanvas');
    var ctx = document.getElementById('myCanvas').getContext('2d');
    var crankSlider=document.getElementById("crankSliderId");
    var connectingRodSlider=document.getElementById("connectingRodSliderId");
    var omega2Slider=document.getElementById("omega2SliderId");

    var angle = 0;
    var fps=60;
    var ratio=canvas.width/1280;
    var aspectRatio=16/9;

    slider = new Slider(200*ratio,50*ratio, canvas, origin = [0]);
    crank = new Rod(200*ratio,10*ratio, canvas, origin = [canvas.width/5,canvas.height/2.75]);
    connectingRod = new Rod(300*ratio,10*ratio, canvas);

    function convertToRadian(degree){
        return degree*(Math.PI/180);
    }

    function convertToDegree(radian){
        return radian/(Math.PI/180);
    }

    function incrementAngle(){
        angle = angle + omega2Slider.value/1;
        if(angle > 360){
            angle = angle - 360;
        }
    }

    function calculatePhi(angle){
        return Math.asin((crank.length * Math.sin(convertToRadian(360 - angle)))/ connectingRod.length)
    }

    function sliderPositionFromCrank(angle){
        return Math.sqrt(Math.pow(connectingRod.length,2) - Math.pow(crank.length*Math.sin(convertToRadian(360 - angle)),2)) + crank.length*Math.cos(convertToRadian(360 - angle))
    }

    function resetOrigin(){
        ctx.setTransform(1, 0, 0, 1, 0, 0);
    }

    function sliderResize(tem,f) {

      tem.style.marginLeft=(canvas.style.marginLeft).toString();
      tem.style.marginTop  =(canvas.style.marginTop).toString();
      tem.style.width=(canvas.width/6).toString()+'px';
      tem.style.left=(f*20+f*canvas.width/6 +canvas.width/30).toString()+'px';
      tem.style.top=(canvas.height/20).toString()+'px';
      }

    function resize(){

    	if(window.innerHeight > window.innerWidth/aspectRatio){
    		canvas.width  = window.innerWidth;
	      canvas.height = window.innerWidth/aspectRatio;
	      canvas.style.marginTop = ((window.innerHeight - canvas.height)/2).toString() + 'px';
	      canvas.style.marginLeft = ((window.innerWidth - canvas.width)/2).toString() + 'px';
    	}

    	else{
      	canvas.height = window.innerHeight;
    		canvas.width = window.innerHeight*aspectRatio;
    		canvas.style.marginLeft = ((window.innerWidth - canvas.width)/2).toString() + 'px';
    		canvas.style.marginTop = ((window.innerHeight - canvas.height)/2).toString() + 'px';
    	}


    sliderResize(crankSlider,0);
    sliderResize(connectingRodSlider,1);
    sliderResize(omega2Slider,2);
    }

    function drawAxis(ctx,startX,startY,endX,endY){
      //y axis
      ctx.beginPath();
      ctx.moveTo(startX[0],startX[1]);
      ctx.lineTo(endX[0],endX[1]);
      ctx.stroke();
      ctx.closePath();

      //x axis
      ctx.beginPath();
      ctx.moveTo(startY[0],startY[1]);
      ctx.lineTo(endY[0],endY[1]);
      ctx.stroke();
      ctx.closePath();
    }
    function drawDynamicGraph(ctx,i,j,fn,adjust,scaling){
        var k;
        for(k=-360;k<=0;k++){
          ctx.beginPath();
          ctx.moveTo(i+k*ratio,j- adjust -(fn(k +angle))*ratio*scaling);
          ctx.lineTo(i+(k+1)*ratio,j- adjust -(fn(k+1 +angle))*ratio*scaling)
          ctx.stroke();
          ctx.closePath();
        }
    }

    function drawGraph(){
      var i = canvas.width - 100*ratio;
      var j = canvas.height;

      ctx.lineWidth=2;
      //axis for slider graph
      drawAxis(ctx,[i-930*ratio,j-50*ratio],
      [i-930*ratio,j-50*ratio],[i-600*ratio,j-50*ratio],[i-930*ratio,(j-(10+sliderPositionFromCrank(0)/3)*ratio)]);

      //axis for phi graph
      drawAxis(ctx,[i-360*ratio,j-150*ratio],[i-360*ratio,j-150*ratio-200*calculatePhi(90)*ratio],[i+10*ratio,j-150*ratio],
      [i-360*ratio,j-150*ratio-200*calculatePhi(270)*ratio])

      //slider vs time graph
      drawDynamicGraph(ctx,i-570*ratio,j+350*ratio,sliderPositionFromCrank,(370+crank.length/10)*ratio,1/3.5);
      //phi vs time graph
      drawDynamicGraph(ctx,i,j,calculatePhi,150*ratio,200);
    }

    function drawTarget(){

        ratio=canvas.width/1280;
    	resize();
        crank.length=crankSlider.value;
        connectingRod.length=connectingRodSlider.value;

        incrementAngle();
        ctx.clearRect(0, 0, canvas.width , canvas.height);

      	crank.attach([canvas.width/5,canvas.height/2.75]);
      	crank.rotate(angle);

      	slider.attach([canvas.width/5 + sliderPositionFromCrank(angle)*ratio, canvas.height/2.75]);
      	slider.rotate(0);

      	connectingRod.attach([canvas.width/5 + crank.length*Math.cos(convertToRadian(angle))*ratio, canvas.height/2.75 + crank.length*Math.sin(convertToRadian(angle))*ratio]);
      	connectingRod.rotate(convertToDegree(calculatePhi(angle)), drawCircumference = false);

      	drawGraph();
    }

    setInterval(drawTarget, 1000/fps);

</script>
</body>
</html>
